{# HTMX-swappable source card. Wrapped in an id for outerHTML replacement. #}
<div id="source-{{ source.pk }}" class="rounded-brand border border-border bg-cream shadow-warm-sm overflow-hidden">

  {# OG Image banner #}
  {% if source.og_image %}
  <div class="h-36 overflow-hidden bg-parchment-alt">
    <img
      src="{{ source.og_image }}"
      alt=""
      class="w-full h-full object-cover"
      loading="lazy"
    >
  </div>
  {% endif %}

  <div class="p-4 space-y-3">
    {# Site name + duplicate badge #}
    <div class="flex items-center gap-2">
      {% if source.og_site_name %}
      <span class="font-mono text-[10px] tracking-wide text-ink-muted uppercase truncate">
        {{ source.og_site_name }}
      </span>
      {% endif %}
      {% if duplicate %}
      <c-badge color="gold" outline>Duplicate</c-badge>
      {% endif %}
      {% if not source.is_pending %}
      <c-badge
        color="{% if source.decision == 'accepted' %}success{% elif source.decision == 'rejected' %}error{% else %}ink{% endif %}"
        outline
      >
        {{ source.get_decision_display }}
      </c-badge>
      {% endif %}
    </div>

    {# Title + URL #}
    <div>
      <a
        href="{{ source.url }}"
        target="_blank"
        rel="noopener noreferrer"
        class="font-body text-[15px] font-semibold text-ink hover:text-terracotta
               no-underline transition-colors duration-150 line-clamp-2"
      >
        {{ source.display_title }}
      </a>
    </div>

    {# Description #}
    {% if source.og_description %}
    <p class="font-body text-[13px] text-ink-secondary leading-relaxed line-clamp-3 m-0">
      {{ source.og_description|truncatewords:30 }}
    </p>
    {% endif %}

    {# Tags #}
    {% if source.tags %}
    <div class="flex flex-wrap gap-1">
      {% for tag in source.tags %}
      <span class="font-mono text-[9px] tracking-wide text-ink-muted
                   px-1.5 py-[2px] bg-parchment-alt rounded border border-border">
        {{ tag }}
      </span>
      {% endfor %}
    </div>
    {% endif %}

    {# Triage actions (only for pending sources) #}
    {% if source.is_pending %}
    <div class="pt-2 border-t border-border">
      <form class="flex items-center gap-2">
        {% csrf_token %}
        <button
          hx-post="{% url 'intake:sourcebox-triage' pk=source.pk %}"
          hx-target="#source-{{ source.pk }}"
          hx-swap="outerHTML"
          hx-vals='{"decision": "accepted"}'
          type="button"
          class="inline-flex items-center gap-1 px-3 py-1.5 rounded-brand
                 font-mono text-[10px] tracking-wide font-bold uppercase
                 bg-success/10 text-success border border-success/20
                 hover:bg-success/20 cursor-pointer transition-colors duration-150"
        >
          Accept
        </button>
        <button
          hx-post="{% url 'intake:sourcebox-triage' pk=source.pk %}"
          hx-target="#source-{{ source.pk }}"
          hx-swap="outerHTML"
          hx-vals='{"decision": "rejected"}'
          type="button"
          class="inline-flex items-center gap-1 px-3 py-1.5 rounded-brand
                 font-mono text-[10px] tracking-wide font-bold uppercase
                 bg-error/10 text-error border border-error/20
                 hover:bg-error/20 cursor-pointer transition-colors duration-150"
        >
          Reject
        </button>
        <button
          hx-post="{% url 'intake:sourcebox-triage' pk=source.pk %}"
          hx-target="#source-{{ source.pk }}"
          hx-swap="outerHTML"
          hx-vals='{"decision": "deferred"}'
          type="button"
          class="inline-flex items-center gap-1 px-3 py-1.5 rounded-brand
                 font-mono text-[10px] tracking-wide font-bold uppercase
                 bg-parchment-alt text-ink-muted border border-border
                 hover:bg-parchment cursor-pointer transition-colors duration-150"
        >
          Defer
        </button>
      </form>
    </div>
    {% endif %}

    {# Timestamp #}
    <time
      datetime="{{ source.created_at|date:'c' }}"
      class="block font-mono text-[9px] tracking-wide text-ink-muted/50"
    >
      Added {{ source.created_at|date:"M j, g:i A" }}
    </time>
  </div>
</div>
