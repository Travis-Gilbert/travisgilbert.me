{% extends "base.html" %}

{% block title %}{{ page_title }}{% endblock %}

{% block content %}
{# ------------------------------------------------------------------ #}
{# Header                                                              #}
{# ------------------------------------------------------------------ #}
<section class="mb-8">
    <a href="{% url 'paper_trail:threads' %}" class="font-mono text-[11px] tracking-wide text-teal no-underline hover:underline mb-2 inline-block">
        &larr; All threads
    </a>
    <div class="flex items-center gap-3 mb-2">
        <h1 class="font-title text-3xl font-bold text-ink m-0">{{ thread.title }}</h1>
        <span class="font-mono text-[9px] tracking-widest uppercase px-1.5 py-0.5 rounded
            {% if thread.status == 'active' %}bg-teal/10 text-teal border border-teal/20
            {% elif thread.status == 'completed' %}bg-success/10 text-success border border-success/20
            {% elif thread.status == 'paused' %}bg-gold/10 text-gold border border-gold/20
            {% else %}bg-bg-alt text-ink-muted border border-border
            {% endif %}
        ">
            {{ thread.get_status_display }}
        </span>
    </div>
    {% if thread.description %}
    <p class="font-body text-ink-muted text-sm max-w-2xl m-0 mb-3">{{ thread.description }}</p>
    {% endif %}
    <div class="flex items-center gap-4">
        {% if thread.started_date %}
        <span class="font-mono text-[10px] tracking-wide text-ink-light">
            Started {{ thread.started_date|date:"M j, Y" }}
        </span>
        {% endif %}
        <span class="font-mono text-[10px] tracking-wide text-ink-light">
            {{ thread.entry_count }} entr{{ thread.entry_count|pluralize:"y,ies" }}
        </span>
        {% if thread.resulting_essay_slug %}
        <a href="{% url 'paper_trail:essay-trail' slug=thread.resulting_essay_slug %}"
           class="font-mono text-[10px] tracking-wide text-terracotta no-underline hover:underline">
            View resulting essay &rarr;
        </a>
        {% endif %}
    </div>
</section>

{# ------------------------------------------------------------------ #}
{# Timeline                                                            #}
{# ------------------------------------------------------------------ #}
<section class="max-w-2xl">
    <div class="relative pl-8 border-l-2 border-border space-y-6">
        {% for entry in thread.entries.all %}
        <div class="relative">
            {# Timeline dot #}
            <span class="absolute -left-[33px] top-2 w-3.5 h-3.5 rounded-full border-2 border-paper
                {% if entry.entry_type == 'milestone' %}bg-terracotta
                {% elif entry.entry_type == 'source' %}bg-teal
                {% elif entry.entry_type == 'connection' %}bg-gold
                {% elif entry.entry_type == 'question' %}bg-error
                {% else %}bg-ink-muted
                {% endif %}
            "></span>

            <div class="bg-surface border border-border rounded-brand p-4">
                {# Entry header #}
                <div class="flex items-center gap-2 mb-2">
                    <span class="font-mono text-[9px] tracking-widest uppercase px-1.5 py-0.5 rounded
                        {% if entry.entry_type == 'milestone' %}bg-terracotta/10 text-terracotta border border-terracotta/20
                        {% elif entry.entry_type == 'source' %}bg-teal/10 text-teal border border-teal/20
                        {% elif entry.entry_type == 'connection' %}bg-gold/10 text-gold border border-gold/20
                        {% elif entry.entry_type == 'question' %}bg-error/10 text-error border border-error/20
                        {% else %}bg-bg-alt text-ink-muted border border-border
                        {% endif %}
                    ">
                        {{ entry.get_entry_type_display }}
                    </span>
                    {% if entry.date %}
                    <span class="font-mono text-[9px] tracking-wide text-ink-light">
                        {{ entry.date|date:"M j, Y" }}
                    </span>
                    {% endif %}
                </div>

                {# Entry body #}
                <p class="font-body text-sm text-ink m-0 leading-relaxed">{{ entry.body }}</p>

                {# Linked source #}
                {% if entry.source %}
                <div class="mt-3 pt-2 border-t border-border-light flex items-center gap-2">
                    <span class="w-1.5 h-1.5 rounded-full bg-teal flex-shrink-0"></span>
                    <span class="font-body text-[13px] text-ink">{{ entry.source.title }}</span>
                    <span class="font-mono text-[9px] tracking-widest uppercase text-ink-light">
                        {{ entry.source.source_type }}
                    </span>
                    {% if entry.source.url %}
                    <a href="{{ entry.source.url }}" target="_blank" rel="noopener"
                       class="font-mono text-[10px] tracking-wide text-teal no-underline hover:underline ml-auto">
                        Visit &nearr;
                    </a>
                    {% endif %}
                </div>
                {% endif %}
            </div>
        </div>
        {% empty %}
        <div class="py-8 text-center">
            <p class="font-body text-sm text-ink-muted m-0">No entries in this thread yet.</p>
        </div>
        {% endfor %}
    </div>
</section>
{% endblock %}
