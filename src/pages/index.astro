---
import BaseLayout from '../layouts/BaseLayout.astro';
import InvestigationCard from '../components/InvestigationCard.astro';
import FieldNoteEntry from '../components/FieldNoteEntry.astro';
import RoughLine from '../components/rough/RoughLine.tsx';
import RoughUnderline from '../components/rough/RoughUnderline.tsx';
import { getCollection } from 'astro:content';

const investigations = (await getCollection('investigations'))
  .filter((i) => !i.data.draft)
  .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf())
  .slice(0, 3);

const fieldNotes = (await getCollection('field-notes'))
  .filter((n) => !n.data.draft)
  .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf())
  .slice(0, 5);
---

<BaseLayout title="Travis Gilbert">
  <!-- Hero -->
  <section class="py-12 md:py-16">
    <h1 class="text-4xl md:text-5xl mb-4" style="font-family: var(--font-name); font-weight: 400;">
      <RoughUnderline client:visible type="underline" color="var(--color-terracotta)" strokeWidth={3}>
        Travis Gilbert
      </RoughUnderline>
    </h1>
    <p class="text-ink-secondary text-lg md:text-xl max-w-2xl leading-relaxed">
      Investigating how design decisions shape human outcomes.
    </p>
  </section>

  <RoughLine client:visible />

  <!-- Latest Investigations -->
  {investigations.length > 0 && (
    <section class="py-8">
      <h2 class="font-heading text-2xl mb-6">Latest Investigations</h2>
      <div class="space-y-6">
        {investigations.map((investigation) => (
          <InvestigationCard
            title={investigation.data.title}
            summary={investigation.data.summary}
            date={investigation.data.date}
            youtubeId={investigation.data.youtubeId}
            tags={investigation.data.tags}
            href={`/investigations/${investigation.id}`}
          />
        ))}
      </div>
      <p class="mt-6">
        <a href="/investigations" class="font-mono text-sm hover:text-terracotta-hover">
          All investigations &rarr;
        </a>
      </p>
    </section>
  )}

  <RoughLine client:visible />

  <!-- Recent Field Notes -->
  {fieldNotes.length > 0 && (
    <section class="py-8">
      <h2 class="font-heading text-2xl mb-6">Recent Field Notes</h2>
      <div class="space-y-4">
        {fieldNotes.map((note) => (
          <FieldNoteEntry
            title={note.data.title}
            date={note.data.date}
            excerpt={note.data.excerpt}
            tags={note.data.tags}
            href={`/field-notes/${note.id}`}
          />
        ))}
      </div>
      <p class="mt-6">
        <a href="/field-notes" class="font-mono text-sm hover:text-terracotta-hover">
          All field notes &rarr;
        </a>
      </p>
    </section>
  )}
</BaseLayout>
